(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),l=m(a(1)),o=m(a(50)),r=a(13),c=a(5),u=m(a(8)),d=m(a(0)),i=a(12),s=m(a(11)),f=m(a(14));function m(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.selectHandler=function(e,t){a.once=e,a.loadTask(1)},a.state={data:[],count:0,currentPage:1},a.once="all",a.pageNumber=30,a.props.setTitle("任务列表"),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.default.PureComponent),n(t,[{key:"componentDidMount",value:function(){this.loadTask(1),(0,f.default)("body").tooltip({selector:'[data-toggle="tooltip"]',trigger:"hover"})}},{key:"componentWillUnmount",value:function(){(0,f.default)('[data-toggle="tooltip"]').tooltip("dispose")}},{key:"loadTask",value:function(e){var t=this;this.modal.loading("加载中..."),(0,u.default)("/serv/task/query",{page:e,number:this.pageNumber,once:this.once,task_name:this.task_name.getValue()},function(a){a.status?t.setState({data:a.data.list,currentPage:e,count:a.data.count},function(){t.modal.close()}):t.modal.alert(a.msg)},function(e){t.modal.alert("远程调用出错!"+e)})}},{key:"openEdit",value:function(e){var t=this;this.modal.view({title:e?"修改通知任务信息":"添加通知任务",content:l.default.createElement(s.default,{loadPath:"/task/edit_task",import:i.GetComponent,taskId:e,callback:function(e){console.log(e),t.modal.close(),t.loadTask(1)}})})}},{key:"delete",value:function(e){var t=this;this.modal.confirm({content:"确定要删除这个任务项?\n["+e.task_name+"]",callback:function(a){a&&(t.modal.loading("删除数据中..."),(0,u.default)("/serv/task/delete",{id:e.id},function(e){e.status?t.modal.alert({content:"删除数据成功!",callback:function(){t.loadTask(t.state.currentPage)}}):t.modal.alert("删除数据失败! "+e.msg)},function(e){t.modal.alert(e)}))}})}},{key:"render",value:function(){var e=this;return l.default.createElement("div",{className:"ck-container"},l.default.createElement(c.Card,null,l.default.createElement("div",{className:"form-inline"},l.default.createElement(c.Input,{ref:function(t){return e.task_name=t},className:"mr-1",placeholder:"任务名称"}),l.default.createElement(c.Button,{icon:"search",onClick:function(){e.loadTask(1)}},"搜索")),l.default.createElement("hr",null),l.default.createElement(c.Tabs,{className:"mb-1",border:!1,content:!1,onSelect:this.selectHandler},l.default.createElement(c.TabsContent,{id:"all",text:"全部任务",active:!0}),l.default.createElement(c.TabsContent,{id:"loop",text:"循环任务"}),l.default.createElement(c.TabsContent,{id:"once",text:"单次任务"})),l.default.createElement("div",{className:"mb-1"},l.default.createElement(c.Button,{className:"mr-1",icon:"sync-alt",onClick:function(t){return e.loadTask(e.state.currentPage)}},"刷新"),l.default.createElement(c.Button,{className:"float-right",icon:"plus",theme:"success",onClick:function(t){return e.openEdit()}},"添加任务")),l.default.createElement(c.Table,{hover:!0,select:!1,headerTheme:"light",data:this.state.data},l.default.createElement(c.Table.Header,{text:"任务ID",field:"id"}),l.default.createElement(c.Table.Header,{text:"任务名称",field:"task_name",onFormat:function(e,t){return l.default.createElement(l.default.Fragment,null,t.disable?l.default.createElement("span",{className:"badge badge-danger"},"禁用"):l.default.createElement("span",{className:"badge badge-success"},"启用"),l.default.createElement(r.Link,{className:"ml-1",to:"/task/log?task_id="+t.id,"data-toggle":"tooltip","data-placement":"top",title:"点击查看通知记录"},e))}}),l.default.createElement(c.Table.Header,{text:"时间规则",field:"time_rule"}),l.default.createElement(c.Table.Header,{text:"通知方式",field:"notify_method"}),l.default.createElement(c.Table.Header,{text:"执行一次",field:"once",onFormat:function(e){return e?l.default.createElement("span",{className:"badge badge-success"},"是"):l.default.createElement("span",{className:"badge badge-danger"},"否")}}),l.default.createElement(c.Table.Header,{text:"已完成",field:"is_execute",onFormat:function(e){return e?l.default.createElement("span",{className:"badge badge-success"},"是"):l.default.createElement("span",{className:"badge badge-danger"},"否")}}),l.default.createElement(c.Table.Header,{text:"通知次数",field:"notify_number"}),l.default.createElement(c.Table.Header,{text:"重送次数",field:"notified_number"}),l.default.createElement(c.Table.Header,{text:"创建时间",field:"created_date",onFormat:function(e){return o.default.unix(e).format("YYYY-MM-DD HH:mm:ss")}}),l.default.createElement(c.Table.Header,{text:"操作",align:"center",onFormat:function(t,a){return l.default.createElement(c.ButtonGroup,null,l.default.createElement(c.Button,{size:"sm",icon:"edit",theme:"secondary",onClick:function(t){e.openEdit(a.id)}},"修改"),l.default.createElement(c.Button,{size:"sm",icon:"trash-alt",theme:"danger",onClick:function(t){e.delete(a)}}))}})),l.default.createElement(c.Pagination,{count:this.state.count,current:this.state.currentPage,number:this.pageNumber,showPage:10,onSelect:function(t){return e.loadTask(t)}})),l.default.createElement(c.Modal,{ref:function(t){return e.modal=t}}))}}]),t}();p.propTypes={},p.defaultProps={},p.contextTypes={router:d.default.object},t.default=p}}]);