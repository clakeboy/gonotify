(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{17:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),l=i(a(1)),r=a(5),s=i(a(8)),o=i(a(0));function i(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={data:{task_name:"",time_rule:"",once:!1,notify_method:"GET",notify_url:"",notify_data:""},number_disabled:!0},a.methodList=["GET","POST","JSON"],a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.default.PureComponent),n(t,[{key:"componentDidMount",value:function(){this.initEdit(this.props.taskId)}},{key:"componentWillReceiveProps",value:function(e){this.initEdit(e.taskId)}},{key:"initEdit",value:function(e){e?this.loadTask(e):this.setState({data:{task_name:"",time_rule:"",once:!1,notify_method:"GET",notify_url:"",notify_data:"",notify_number:0,time_rule_sec:"0",time_rule_min:"*",time_rule_hor:"*",time_rule_day:"*",time_rule_mon:"*",time_rule_wek:"*"},number_disabled:!0})}},{key:"loadTask",value:function(e){var t=this;this.modal.loading("加载中..."),(0,s.default)("/serv/task/find",{id:e},function(e){if(e.status){var a=e.data.time_rule.split(" ");e.data.time_rule_sec=a[0],e.data.time_rule_min=a[1],e.data.time_rule_hor=a[2],e.data.time_rule_day=a[3],e.data.time_rule_mon=a[4],e.data.time_rule_wek=a[5],t.setState({data:e.data,number_disabled:!e.data.once},function(){t.modal.close()})}else t.modal.alert("获取任务信息失败!\n"+e.msg)},function(e){t.modal.alert("远程调用出错! "+e)})}},{key:"changeHandler",value:function(e){var t=this;return function(a){var n=t.state.data;n[e]=a,t.setState({data:n})}}},{key:"save",value:function(){var e=this;console.log(this.state.data);var t="/serv/task/insert";this.state.data.id&&(t="/serv/task/update");var a=[];a.push(this.state.data.time_rule_sec),a.push(this.state.data.time_rule_min),a.push(this.state.data.time_rule_hor),a.push(this.state.data.time_rule_day),a.push(this.state.data.time_rule_mon),a.push(this.state.data.time_rule_wek),this.state.data.time_rule=a.join(" "),this.state.data.notify_number=parseInt(this.state.data.notify_number),(0,s.default)(t,this.state.data,function(t){t.status?e.modal.alert({content:"编辑任务信息成功!",callback:function(){e.props.callback("save done")}}):e.modal.alert("编辑任务信息出错!"+t.msg)},function(t){e.modal.alert("远程调用出错! "+t)})}},{key:"render",value:function(){var e=this;return l.default.createElement("div",null,l.default.createElement("div",{className:"form-row"},l.default.createElement(r.Input,{className:"col-6",label:"任务名称",data:this.state.data.task_name,onChange:this.changeHandler("task_name")}),l.default.createElement(r.Input,{className:"col-1",label:"秒",data:this.state.data.time_rule_sec,onChange:this.changeHandler("time_rule_sec"),placeholder:"秒"}),l.default.createElement(r.Input,{className:"col-1",label:"分",data:this.state.data.time_rule_min,onChange:this.changeHandler("time_rule_min"),placeholder:"分"}),l.default.createElement(r.Input,{className:"col-1",label:"时",data:this.state.data.time_rule_hor,onChange:this.changeHandler("time_rule_hor"),placeholder:"时"}),l.default.createElement(r.Input,{className:"col-1",label:"天",data:this.state.data.time_rule_day,onChange:this.changeHandler("time_rule_day"),placeholder:"天"}),l.default.createElement(r.Input,{className:"col-1",label:"月",data:this.state.data.time_rule_mon,onChange:this.changeHandler("time_rule_mon"),placeholder:"月"}),l.default.createElement(r.Input,{className:"col-1",label:"周天",data:this.state.data.time_rule_wek,onChange:this.changeHandler("time_rule_wek"),placeholder:"周天"})),l.default.createElement("div",{className:"form-row"},l.default.createElement(r.Select,{className:"col-2",label:"通知方法",data:this.methodList,onSelect:function(t){console.log(t.target.value);var a=e.state.data;a.notify_method=t.target.value,e.setState({data:a})},value:this.state.data.notify_method}),l.default.createElement(r.Input,{className:"col-10",label:"通知地址",placeholder:"URL 地址",data:this.state.data.notify_url,onChange:this.changeHandler("notify_url")})),l.default.createElement("div",{className:"form-row form-group"},l.default.createElement("div",{className:"col-2 d-flex align-items-center"},l.default.createElement(r.Checkbox,{label:"通知一次",onChange:function(t){var a=e.state.data;a.once=t.target.checked,e.setState({data:a,number_disabled:!t.target.checked})},checked:this.state.data.once})),l.default.createElement("div",{className:"col-10"},l.default.createElement(r.InputGroup,{className:"ck-clear-m",label:"重送次数",type:"number",onChange:this.changeHandler("notify_number"),disabled:this.state.number_disabled,data:this.state.data.notify_number,placeholder:"失败重送次数"}))),l.default.createElement(r.TextArea,{label:"通知数据 (JSON字符串)",data:this.state.data.notify_data,onChange:this.changeHandler("notify_data"),rows:5}),l.default.createElement("div",{className:"form-row"},l.default.createElement("div",{className:"col-6"},l.default.createElement(r.Checkbox,{className:"text-danger",label:"禁用",onChange:function(t){var a=e.state.data;a.disable=t.target.checked,e.setState({data:a})},checked:this.state.data.disable})),l.default.createElement("div",{className:"col-6"},l.default.createElement(r.Button,{className:"float-right",icon:"save",onClick:function(){return e.save()}},"保存"))),l.default.createElement(r.Modal,{ref:function(t){return e.modal=t}}))}}]),t}();d.propTypes={},d.defaultProps={},d.contextTypes={router:o.default.object},t.default=d}}]);